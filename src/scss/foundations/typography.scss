@use "../lib";
@use "breakpoints";
@use "global";

/**
 * Physical address of the fonts-containing folder
 * @type String
 * @access public
 */
$fontPath: "../fonts" !default;

/**
 * Name of Pyxis base font-family
 *
 * @type String
 * @access private
 */
$_fontFamily: "Circular";

/**
 * Base font-family with fallback
 *
 * @type Number
 * @access private
 */
$_fontFamilyWithFallback: $_fontFamily, "Arial", sans-serif;

/**
 * Font feature settings for Circular font
 * The "ss08" setting allows to make numbers tall as uppercase letters
 *
 * @type List
 * @access private
 */
$_fontFeatureSettings: "ss08" on;

/**
 * Font weight for light typography
 *
 * @type Number
 * @access private
 */
$_fontWeightLight: 200;

/**
 * Font weight for regular typography
 *
 * @type Number
 * @access private
 */
$_fontWeightBook: 400;

/**
 * Font weight for bold typography
 *
 * @type Number
 * @access private
 */
$_fontWeightBold: 700;

/**
 * The map of font-weight available in Pyxis
 *
 * @type Map
 * @access private
 */
$_fontWeights: (
  light: $_fontWeightLight,
  book: $_fontWeightBook,
  bold: $_fontWeightBold,
);

/**
 * The map of fonts and font-weight available in Pyxis
 *
 * @type Map
 * @access private
 */
$_fonts: (
  light: (
    fileName: "CircularXXWeb-Light",
    weight: $_fontWeightLight
  ),
  book: (
    fileName: "CircularXXWeb-Book",
    weight: $_fontWeightBook
  ),
  bold: (
    fileName: "CircularXXWeb-Bold",
    weight: $_fontWeightBold
  ),
);

/**
 + Responsive title map
 *
 * @type Map
 * @access private
 */
$_titleFontSize: (
  xl: (
    base: (
      fontSize: 28px,
      lineHeight: 42px
    ),
    small: (
      fontSize: 32px,
      lineHeight: 50px
    ),
    large: (
      fontSize: 40px,
      lineHeight: 60px
    )
  ),
  l: (
    base: (
      fontSize: 24px,
      lineHeight: 38px
    ),
    small: (
      fontSize: 26px,
      lineHeight: 42px
    ),
    large: (
      fontSize: 32px,
      lineHeight: 50px
    )
  ),
  m: (
    base: (
      fontSize: 20px,
      lineHeight: 32px
    ),
    small: (
      fontSize: 22px,
      lineHeight: 34px
    ),
    large: (
      fontSize: 24px,
      lineHeight: 38px
    )
  ),
  s: (
    base: (
      fontSize: 16px,
      lineHeight: 26px
    ),
    small: (
      fontSize: 18px,
      lineHeight: 28px
    ),
    large: (
      fontSize: 20px,
      lineHeight: 32px
    )
  ),
);

/**
 * Responsive text map
 *
 * @type Map
 * @access private
 */
$_textFontSize: (
  l: (
    base: (
      fontSize: 14px,
      lineHeight: 22px,
      letterSpacing: 0.1px,
    ),
    small: (
      fontSize: 16px,
      lineHeight: 26px,
      letterSpacing: 0.1px,
    ),
  ),
  m: (
    base: (
      fontSize: 12px,
      lineHeight: 20px,
      letterSpacing: 0.3px,
    ),
    small: (
      fontSize: 14px,
      lineHeight: 22px,
      letterSpacing: 0.1px,
    ),
  ),
  s: (
    base: (
      fontSize: 12px,
      lineHeight: 20px,
      letterSpacing: 0.3px,
    ),
  ),
);

/**
 * Base setting for Pyxis typography
 *
 * @access public
 */
@mixin typographySetting() {
  font-family: $_fontFamilyWithFallback;
  font-feature-settings: $_fontFeatureSettings;
  font-size: global.$fontSizeRoot;
  -moz-osx-font-smoothing: grayscale;
  -webkit-font-smoothing: antialiased;
  font-variant-ligatures: none;
  font-weight: $_fontWeightBook;
  text-rendering: optimizeLegibility;
}

/**
 * Include the font-weight by name available in $_fontWeights
 *
 * @access public
 */
@mixin fontWeight($weight) {
  font-weight: #{lib.getOrDie($_fonts, $weight, weight)};
}

/**
 * Include the responsive title size by name available in $_titleFontSize
 *
 * @access public
 */
@mixin title($size) {
  @each $breakpointName, $titleMap in lib.getOrDie($_titleFontSize, $size) {
    @if $breakpointName == base {
      font-size: lib.rem(lib.getOrDie($titleMap, fontSize));
      line-height: lib.rem(lib.getOrDie($titleMap, lineHeight));
    } @else {
      @include breakpoints.mq($breakpointName) {
        font-size: lib.rem(lib.getOrDie($titleMap, fontSize));
        line-height: lib.rem(lib.getOrDie($titleMap, lineHeight));
      }
    }
  }
}

/**
 * Include the responsive text size by name available in $_textFontSize
 *
 * @access public
 */
@mixin text($size) {
  @each $breakpointName, $textMap in lib.getOrDie($_textFontSize, $size) {
    @if $breakpointName == base {
      font-size: lib.rem(lib.getOrDie($textMap, fontSize));
      letter-spacing: lib.rem(lib.getOrDie($textMap, letterSpacing));
      line-height: lib.rem(lib.getOrDie($textMap, lineHeight));
    } @else {
      @include breakpoints.mq($breakpointName) {
        font-size: lib.rem(lib.getOrDie($textMap, fontSize));
        letter-spacing: lib.rem(lib.getOrDie($textMap, letterSpacing));
        line-height: lib.rem(lib.getOrDie($textMap, lineHeight));
      }
    }
  }
}

/**
 * Create atom classes for all title and text variant in $_titleFontSize map and $_textFontSize map
 *
 * @access public
 */
@mixin createTypographyAtoms() {
  @each $titleName, $titleMap in $_titleFontSize {
    .title-#{lib.camelToKebabCase($titleName)} {
      @include title($titleName);
    }
  }

  @each $textName, $textMap in $_textFontSize {
    .text-#{lib.camelToKebabCase($textName)} {
      @include text($textName);
    }
  }
}

/**
 * Create @font-face for all fonts available in $_fonts map
 */
@each $name, $font in $_fonts {
  @font-face {
    font-display: swap;
    font-family: $_fontFamily;
    font-style: normal;
    font-weight: #{map-get($font, weight)};
    src:
      url("#{$fontPath}/#{map-get($font, fileName)}.woff") format("woff"),
      url("#{$fontPath}/#{map-get($font, fileName)}.woff2") format("woff2");
  }
}